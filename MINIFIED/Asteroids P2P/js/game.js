var AsteroidMath=AsteroidMath||{};AsteroidMath.BootState={init:function(){this.game.stage.backgroundColor='#000',this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.game.stage.disableVisibilityChange=!0},preload:function(){this.load.image('bar','assets/images/preloader-bar.png')},create:function(){this.state.start('Preload')}};var AsteroidMath=AsteroidMath||{};AsteroidMath.EndState={init:function(){},preload:function(){AsteroidMath.GameState.bgSound&&AsteroidMath.GameState.bgSound.destroy(),this.blueScore=AsteroidMath.MenuState.blueScore,this.redScore=AsteroidMath.MenuState.redScore,this.roundLen=this.blueScore.length,this.blueTotalScore=0,this.redTotalScore=0},create:function(){this.game.stage.backgroundColor='black';var a=this.game.add.sprite(this.game.width/2,this.game.height/2,'endbackground');a.anchor.setTo(0.5),a.scale.setTo(0.5),this.roundTexts=this.game.add.group(),this.blueScoreTexts=this.game.add.group(),this.redScoreTexts=this.game.add.group(),this.createScoreTexts(),this.createScoreTable()},createScoreTexts:function(){for(var a={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'40px'},b=300,c=300,d=220,e=440,f=55,g=0;g<this.roundLen;g++){var h={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'50px'},j=this.game.add.text(this.game.width/2,100,'TULOKSET',h);j.anchor.setTo(0.5);var k=this.game.add.text(b,c+f*g,this.blueScore[g].level,a);k.visible=!1,k.anchor.setTo(0.5),this.roundTexts.add(k);var l=this.blueScore[g].score<this.redScore[g].score?'green':'white',m='white'==l?'green':'white';this.blueScore[g].score==this.redScore[g].score&&(l='white',m='white');var n=this.game.add.text(k.x+d,c+f*g,this.blueScore[g].score,a);n.anchor.setTo(0.5),n.visible=!1,n.fill=m,this.blueScoreTexts.add(n),this.blueTotalScore+=this.blueScore[g].score;var o=this.game.add.text(k.x+e,c+f*g,this.redScore[g].score,a);o.anchor.setTo(0.5),o.visible=!1,o.fill=l,this.redScoreTexts.add(o),this.redTotalScore+=this.redScore[g].score}var p=this.game.add.text(b,c+f*this.roundLen,'Yhteens\xE4',a);p.anchor.setTo(0.5),p.visible=!1,this.roundTexts.add(p),this.blueTotalScoreText=this.game.add.text(b+d,c+f*this.roundLen,this.blueTotalScore,a),this.blueTotalScoreText.anchor.setTo(0.5),this.blueTotalScoreText.visible=!1,this.redTotalScoreText=this.game.add.text(b+e,c+f*this.roundLen,this.redTotalScore,a),this.redTotalScoreText.anchor.setTo(0.5),this.redTotalScoreText.visible=!1,this.blueNameText=this.game.add.text(b+d,c-f,'Sininen',a),this.blueNameText.anchor.setTo(0.5),this.redNameText=this.game.add.text(b+e,c-f,'Punainen',a),this.redNameText.anchor.setTo(0.5);var q=this.game.add.sprite(this.blueNameText.x,this.blueNameText.y-50,'ships','ship_blue.png');q.anchor.setTo(0.5),q.scale.setTo(-1.2);var r=this.game.add.sprite(this.redNameText.x,this.redNameText.y-50,'ships','ship_red.png');r.anchor.setTo(0.5),r.scale.setTo(-1.2)},createScoreTable:function(){var a=500,b=1e3,c=1e3,d=b,e=b,f=b;this.roundTexts.forEach(function(t){t.visible=!0;this.game.add.tween(t).from({y:-50},a,Phaser.Easing.Bounce.Out,!0,d,0);d+=c},this),this.blueScoreTexts.forEach(function(t){t.visible=!0;this.game.add.tween(t).from({y:-50},a,Phaser.Easing.Bounce.Out,!0,e,0);e+=c},this),this.redScoreTexts.forEach(function(t){t.visible=!0;this.game.add.tween(t).from({y:-50},a,Phaser.Easing.Bounce.Out,!0,f,0);f+=c},this);var g=b+c*this.roundTexts.children.length,h=g+a,j=this.game.add.text(),k=this.game.add.tween(this.blueTotalScoreText).from({y:-50},a,Phaser.Easing.Bounce.Out,!0,h,0);k.onStart.add(function(){this.blueTotalScoreText.visible=!0},this);var l=this.game.add.tween(this.redTotalScoreText).from({y:-50},a,Phaser.Easing.Bounce.Out,!0,h,0);l.onStart.add(function(){this.redTotalScoreText.visible=!0},this);var m={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'44px'},n=this.blueTotalScore==this.redTotalScore;if(!n){var o=this.blueTotalScore>this.redTotalScore?this.blueTotalScoreText:this.redTotalScoreText,p=this.blueTotalScore>this.redTotalScore?'ship_blue.png':'ship_red.png',q=this.blueTotalScore>this.redTotalScore?'Sininen':'Punainen',r=this.game.add.tween(o.scale).to({x:1.5,y:1.5},500,'Linear',!0,h+500,-1,!0);r.onStart.add(function(){o.fill='green'},this),this.game.time.events.add(h+1e3,function(){var t=this.game.add.text(300,600,'Voittaja: '+q,m),u=t.x+500,v=t.y+25;manager=this.game.plugins.add(Phaser.ParticleStorm);manager.addData('basic',{lifespan:5e3,red:255,green:255,blue:255,vx:{min:-0.5,max:0.5},vy:{min:-0.5,max:0.5}});var z=manager.createLineZone(u-50,v,u+50,v);emitter=manager.createEmitter(Phaser.ParticleStorm.PIXEL),emitter.addToWorld(),emitter.emit('basic',0,0,{zone:z,total:7,repeat:-1,frequency:60});var A=this.game.add.sprite(u,v,'ships',p);A.anchor.setTo(0.5),A.scale.setTo(-2.5,2.5)},this)}else this.game.time.events.add(h+1e3,function(){var t=this.game.add.text(600,600,'Tasapeli!',m);t.anchor.setTo(0.5)},this);this.restartButton=this.game.add.button(600,720,'button1',function(){this.game.state.start('Menu')},this),this.restartButton.anchor.setTo(0.5),this.restartButton.scale.setTo(0.5);var s={font:AsteroidMath.GameState.font1,fill:'green',fontSize:'34px'};this.restartButtonText=this.game.add.text(this.restartButton.x,this.restartButton.y+10,'Alkuun',s),this.restartButtonText.anchor.setTo(0.5),this.restartButtonText.setShadow(3,3,'rgba(0,0,0,0.5)',5),this.restartButton.onInputOver.add(function(){this.restartButton.alpha=0.7},this),this.restartButton.onInputOut.add(function(){this.restartButton.alpha=1},this)},update:function(){}};var AsteroidMath=AsteroidMath||{};AsteroidMath.GameState={init:function(a){this.THRUST=350,this.DEBUG=!1,this.SHIPMASS=1,this.SHIPBODYDAMPING=0.4,this.ASTEROIDBODYDAMPING=0.5,this.gameOn=!0,this.font2='source_sans_prosemibold',this.font1='inconsolataregular',this.assetScaleFactor=0.25,this.levelData=a,this.blueData={},this.blueData.spawn=this.levelData.BLUEspawn,this.blueData.homeArea=this.levelData.BLUEhomeArea,this.blueData.getWidth=function(){return this.homeArea.x2-this.homeArea.x1},this.blueData.getHeight=function(){return this.homeArea.y2-this.homeArea.y1},this.blueData.angle=this.levelData.BLUEangle,this.blueData.score=0,this.blueData.scoreText=this.levelData.BLUEscoreText,this.blueData.collecting=this.levelData.BLUEcollecting,this.blueData.gravityLine=this.levelData.BLUEgravityLine,this.redData={},this.redData.spawn=this.levelData.REDspawn,this.redData.homeArea=this.levelData.REDhomeArea,this.redData.getWidth=function(){return this.homeArea.x2-this.homeArea.x1},this.redData.getHeight=function(){return this.homeArea.y2-this.homeArea.y1},this.redData.angle=this.levelData.REDangle,this.redData.score=0,this.redData.scoreText=this.levelData.REDscoreText,this.redData.collecting=this.levelData.REDcollecting,this.redData.gravityLine=this.levelData.REDgravityLine,this.redData.answerTextWithX=this.game.add.text(),this.redData.answerTextWithOutX=this.game.add.text(),this.blueData.answerTextWithX=this.game.add.text(),this.blueData.answerTextWithOutX=this.game.add.text(),this.game.physics.startSystem(Phaser.Physics.P2JS)},create:function(){this.walls=this.add.group(),this.walls.enableBody=!0,this.walls.physicsBodyType=Phaser.Physics.P2JS,this.guiIconGroupBlue=this.game.add.group(),this.guiIconGroupRed=this.game.add.group(),this.guiTextGroupBlue=this.game.add.group(),this.guiTextGroupRed=this.game.add.group(),this.game.world.sendToBack(this.guiIconGroupBlue),this.game.world.sendToBack(this.guiIconGroupRed),this.game.world.sendToBack(this.guiTextGroupBlue),this.game.world.sendToBack(this.guiTextGroupRed),this.playerCollisionGroup=this.game.physics.p2.createCollisionGroup(),this.asteroidCollisionGroup=this.game.physics.p2.createCollisionGroup(),this.wallsCollisionGroup=this.game.physics.p2.createCollisionGroup(),this.backgroundCollisionGroup=this.game.physics.p2.createCollisionGroup(),this.game.world.setBounds(0,0,1200,800),this.game.physics.p2.setImpactEvents(!0),this.game.physics.p2.restitution=0.5,this.game.physics.p2.updateBoundsCollisionGroup(),this.game.stage.backgroundColor='#000',this.valueData=Object.values(JSON.parse(this.game.cache.getText(this.levelData.jsonValues))),this.createBackground(),this.createShips(),this.materialsSetUp(),this.asteroids=this.add.group(),this.asteroids.enableBody=!0,this.asteroids.physicsBodyType=Phaser.Physics.P2JS,this.missionTable=this.game.add.group(),this.loadLevel(),this.testTasks(),this.createPauseBtn(),this.sound1=this.game.add.audio('1'),this.sound2=this.game.add.audio('2'),this.sound3=this.game.add.audio('3'),this.soundBegin=this.game.add.audio('begin'),this.bgSound=this.game.add.audio('bgMusic'),this.bgSound.loop=!0,this.bgSound.play()},update:function(){if(this.cursors.left.isDown?this.shipRed.body.rotateLeft(50):this.cursors.right.isDown?this.shipRed.body.rotateRight(50):this.shipRed.body.setZeroRotation(),this.cursors.up.isDown){this.shipRed.body.thrust(this.THRUST);var a=this.shipRed.body.angle,b=-Math.sin(0.0174532925*a),c=Math.cos(0.0174532925*a),d=this.shipRed.x+18*b,e=this.shipRed.y+18*c;this.redEmitterData.vx={value:{min:4*b,max:5*b}},this.redEmitterData.vy={value:{min:4*c,max:5*c}},this.redShipEmitter.emit('basic',d,e,{zone:this.redShipCircle,total:1})}else this.cursors.down.isDown&&this.shipRed.body.reverse(this.THRUST/2);if(this.shipBlueLeft.isDown?this.shipBlue.body.rotateLeft(50):this.shipBlueRight.isDown?this.shipBlue.body.rotateRight(50):this.shipBlue.body.setZeroRotation(),this.shipBlueUp.isDown){this.shipBlue.body.thrust(this.THRUST);var a=this.shipBlue.body.angle,b=-Math.sin(0.0174532925*a),c=Math.cos(0.0174532925*a),d=this.shipBlue.x+18*b,e=this.shipBlue.y+18*c;this.blueEmitterData.vx={value:{min:b,max:2*b}},this.blueEmitterData.vy={value:{min:c,max:2*c}},this.blueShipEmitter.emit('basic',d,e,{zone:this.blueShipCircle,total:1})}else this.shipBlueDown.isDown&&this.shipBlue.body.reverse(this.THRUST/2)},createShips:function(){this.shipBlue=this.game.add.sprite(this.blueData.spawn.x,this.blueData.spawn.y,'ships','ship_blue.png'),this.game.physics.p2.enable(this.shipBlue,this.DEBUG),this.shipBlue.body.clearShapes(),this.shipBlue.body.loadPolygon('physics','ship'),this.shipBlue.body.collideWorldBounds=!0,this.shipBlue.body.setCollisionGroup(this.playerCollisionGroup),this.shipBlue.body.collides(this.asteroidCollisionGroup,this.asteroidCollide,this),this.shipBlue.body.collides(this.playerCollisionGroup,null,this),this.shipBlue.body.collides(this.wallsCollisionGroup,null,this),this.shipBlue.body.collides(this.backgroundCollisionGroup,null,this),this.shipBlue.body.mass=this.SHIPMASS,this.shipBlue.body.angle=this.blueData.angle,this.shipBlue.anchor.setTo(0.5),this.shipBlue.body.damping=this.SHIPBODYDAMPING,this.blueParticleManager=this.game.plugins.add(Phaser.ParticleStorm),this.blueEmitterData={image:'4x4_blue',lifespan:750,blendMode:'ADD',alpha:{initial:0,value:0.9,control:'linear'},scale:{value:1,control:[{x:0,y:0.75}]},sendToBack:!0},this.blueParticleManager.addData('basic',this.blueEmitterData),this.blueShipCircle=this.blueParticleManager.createCircleZone(10),this.blueShipEmitter=this.blueParticleManager.createEmitter(),this.blueShipEmitter.addToWorld(),this.shipRed=this.game.add.sprite(this.redData.spawn.x,this.redData.spawn.y,'ships','ship_red.png'),this.game.physics.p2.enable(this.shipRed,this.DEBUG),this.shipRed.body.clearShapes(),this.shipRed.body.loadPolygon('physics','ship'),this.shipRed.body.collideWorldBounds=!0,this.shipRed.body.setCollisionGroup(this.playerCollisionGroup),this.shipRed.body.collides(this.asteroidCollisionGroup,this.asteroidCollide,this),this.shipRed.body.collides(this.playerCollisionGroup,null,this),this.shipRed.body.collides(this.wallsCollisionGroup,null,this),this.shipRed.body.collides(this.backgroundCollisionGroup,null,this),this.shipRed.body.mass=this.SHIPMASS,this.shipRed.body.angle=this.redData.angle,this.shipRed.body.debug=this.DEBUG,this.shipRed.body.damping=this.SHIPBODYDAMPING,this.redParticleManager=this.game.plugins.add(Phaser.ParticleStorm),this.redEmitterData={image:'4x4_red',lifespan:750,blendMode:'ADD',alpha:{initial:0,value:0.9,control:'linear'},scale:{value:1,control:[{x:0,y:0.75}]},sendToBack:!0},this.redParticleManager.addData('basic',this.redEmitterData),this.redShipCircle=this.redParticleManager.createCircleZone(10),this.redShipEmitter=this.redParticleManager.createEmitter(),this.redShipEmitter.addToWorld(),this.cursors=this.game.input.keyboard.createCursorKeys(),this.shipBlueUp=this.game.input.keyboard.addKey(Phaser.Keyboard.W),this.shipBlueDown=this.game.input.keyboard.addKey(Phaser.Keyboard.S),this.shipBlueLeft=this.game.input.keyboard.addKey(Phaser.Keyboard.A),this.shipBlueRight=this.game.input.keyboard.addKey(Phaser.Keyboard.D)},roundEnd:function(){AsteroidMath.MenuState.blueScore.push({level:this.levelData.name,score:this.blueData.score}),AsteroidMath.MenuState.redScore.push({level:this.levelData.name,score:this.redData.score}),null==this.levelData.nextLevel?(this.bgSound.destroy(),this.game.state.start('End')):this.nextLevelMenu()},nextLevelMenu:function(){var a=this.game.add.graphics();a.lineStyle(1,'black',1),a.beginFill(16777215,0.9),a.drawRoundedRect(400,300,400,200),a.endFill();var b={fontSize:'24px',fill:this.font1,fill:'black'},c=this.game.add.text(this.game.width/2,this.game.height/2-50,'Taso suoritettu!',b);c.anchor.setTo(0.5);var d=this.add.graphics(0,0);d.lineStyle(1,'black',1),d.beginFill(255,1),d.drawRect(this.game.width/2-100,this.game.height/2+25,200,50),d.endFill(),d.inputEnabled=!0,d.events.onInputDown.add(function(){AsteroidMath.MenuState.click.play(),this.bgSound.destroy(),this.game.state.start('Game',!0,!1,this.levelData.nextLevel)},this),d.events.onInputOut.add(function(){d.alpha=1},this),d.events.onInputOver.add(function(){d.alpha=0.8},this);var e={fontSize:'24px',fill:this.font1,fill:'white'},f=this.game.add.text(this.game.width/2,this.game.height/2+50,'Seuraava taso',e);f.anchor.setTo(0.5)},createBackground:function(){var a=this.game.plugins.add(Phaser.ParticleStorm),b={lifespan:3500,blendMode:'ADD',alpha:{initial:0,value:0.5,control:'linear'},image:'4x4_blue',vy:{min:-0.5,max:0},vx:{min:-0.2,max:0.2}};a.addData('basic',b),blueGravityEmitter=a.createEmitter();var c=blueGravityEmitter.createGravityWell(this.blueData.homeArea.x1+this.blueData.getWidth()/2,this.blueData.homeArea.y1+this.blueData.getHeight()/2,1,200),d=a.createLineZone(this.blueData.gravityLine.x1,this.blueData.gravityLine.y1,this.blueData.gravityLine.x2,this.blueData.gravityLine.y2);blueGravityEmitter.addToWorld(),blueGravityEmitter.emit('basic',0,0,{zone:d,total:2,repeat:-1,frequency:150});var e=this.game.plugins.add(Phaser.ParticleStorm),b={lifespan:3500,blendMode:'ADD',alpha:{initial:0,value:0.5,control:'linear'},image:'4x4_red',vy:{min:0,max:0.5},vx:{min:-0.2,max:0.2}};e.addData('basic',b),redGravityEmitter=e.createEmitter();var c=redGravityEmitter.createGravityWell(this.redData.homeArea.x1+this.redData.getWidth()/2,this.redData.homeArea.y1+this.redData.getHeight()/2,1,200),d=e.createLineZone(this.redData.gravityLine.x1,this.redData.gravityLine.y1,this.redData.gravityLine.x2,this.redData.gravityLine.y2);redGravityEmitter.addToWorld(),redGravityEmitter.emit('basic',0,0,{zone:d,total:2,repeat:-1,frequency:150});var f=this.game.add.sprite(this.game.width/2,this.game.height/2,this.levelData.background);if(this.game.physics.p2.enable(f,this.DEBUG),f.body.clearShapes(),f.scale.set(0.5),f.body.loadPolygon('physics',this.levelData.background),f.body.static=!0,f.body.setCollisionGroup(this.backgroundCollisionGroup),f.body.collides(this.asteroidCollisionGroup,null,this),f.body.collides(this.playerCollisionGroup,null,this),f.body.collides(this.wallsCollisionGroup,null,this),this.game.world.sendToBack(f),this.levelData.walls){var g=this.levelData.walls;Object.keys(g).forEach(function(h){var j=this.game.add.sprite(g[h].x,g[h].y,'sprites',h+'.png');this.game.physics.p2.enable(j,this.DEBUG),j.body.clearShapes(),j.scale.set(this.assetScaleFactor),j.body.loadPolygon('physics',h),j.body.static=g[h].staticBody,j.body.angle=g[h].angle,g[h].mass&&(j.body.mass=g[h].mass),j.body.setCollisionGroup(this.wallsCollisionGroup),j.body.collides([this.backgroundCollisionGroup,this.wallsCollisionGroup,this.asteroidCollisionGroup,this.playerCollisionGroup])},this)}},loadLevel:function(){this.countDownTime=this.game.time.create(!0);var b=0,c=this.game.add.text(this.game.world.centerX,this.game.world.centerY-200,'',{font:'64px Arial Black',fill:'#0037ff',align:'center'});c.anchor.setTo(0.5),this.countDownTime.start(),this.countDownTime.loop(1e3,function(){if(b+=0.5,0.5==b)c.setText(this.levelData.name);else if(1==b)c.setText('3'),this.sound3.play();else if(2==b)c.setText('2'),this.sound2.play();else if(3==b)c.setText('1'),this.sound1.play();else if(4==b){this.soundBegin.play(),this.countDownTime.stop(),c.destroy(),this.loadLevelTexts();for(var d=this.levelData.spawnCoords,e=0;e<this.levelData.spawnCoords.length;e++)this.createRandomAsteroid(d[e][0],d[e][1])}},this)},loadLevelTexts:function(){var a={font:this.font1,fontSize:'34px',fill:this.levelData.textColor},b={font:this.font1,fontSize:'26px',fill:this.levelData.textColor},c={font:this.font1,fontSize:'30px',fill:this.levelData.textColor},d={font:this.font1,fontSize:'14px',fill:this.levelData.textColor},e={font:this.font1,fontSize:'16px',fill:this.levelData.textColor};this.roundNoText=this.game.add.text(600,350,this.levelData.name,e),this.roundNoText.anchor.setTo(0.5),this.xValueText=this.game.add.text(600,370,'x = '+this.levelData.xValue,a),this.xValueText.anchor.setTo(0.5),this.game.world.bringToTop(this.xValueText),this.levelData.xValue=this.levelData.xValues[Math.floor(Math.random()*this.levelData.xValues.length)],this.xValueText.setText('x = '+this.levelData.xValue),this.xTimer=this.game.time.create(!0),this.xTimer.loop(1e3*this.levelData.xChangeTime+3,function(){var v=this.levelData.xValues.slice(),w=v.indexOf(this.levelData.xValue);v.splice(w,1),this.levelData.xValue=v[Math.floor(Math.random()*v.length)],this.xValueText.setText('x = '+this.levelData.xValue);var z=this.game.add.tween(this.xValueText.scale).to({x:1.5,y:1.5},500,'Expo.easeOut',!0),A=this.game.add.tween(this.xValueText.scale).to({x:1,y:1},500,'Expo.easeOut',!1);z.onComplete.add(function(){A.start()},this)},this),this.xTimer.start();var f=515,g=412,h=170,j=22,k=0.25,l=1,m='0x000000',n='0x0000FF',o='0x000000',p='0x00FF00';this.nextRoundBarBG=this.game.add.graphics(0,0),this.nextRoundBarBG.lineStyle(l,m),this.nextRoundBarBG.beginFill(n,k),this.nextRoundBarBG.drawRoundedRect(f,g,h,j,1),this.nextRoundBarBG.endFill(),this.nextRoundBar=this.game.add.graphics(0,0),this.nextRoundText=this.game.add.text(600,g+13,'Seuraava taso',d),this.nextRoundText.anchor.setTo(0.5),this.roundTimer=this.game.time.create(!0),this.roundTimerCount=0,this.roundTimer.loop(250,function(){var v=Math.min(h*this.roundTimerCount/this.levelData.roundTime,h);0<v&&(this.nextRoundBar.clear(),this.nextRoundBar.lineStyle(0.5,o),this.nextRoundBar.beginFill(p,1),this.nextRoundBar.drawRoundedRect(f,g,v,j,1),this.nextRoundBar.endFill()),0>=this.levelData.roundTime-this.roundTimerCount&this.gameOn&&(this.gameOn=!1,this.roundEnd()),this.roundTimerCount+=0.25},this),this.roundTimer.start();var q=515,r=385,s=170,t=20;this.xChangeBarBG=this.game.add.graphics(0,0),this.xChangeBarBG.lineStyle(l,m),this.xChangeBarBG.beginFill(n,k),this.xChangeBarBG.drawRoundedRect(q,r,s,t,1),this.xChangeBarBG.endFill(),this.xChangeBar=this.game.add.graphics(0,0),this.xValueChangeTextInfo=this.game.add.text(600,r+12,'Aikaa muuttujan vaihtoon',d),this.xValueChangeTextInfo.anchor.setTo(0.5),this.xChangeTimer=this.game.time.create(!0),this.xChangeTimer.loop(250,function(){var v=s*this.roundTimerCount/this.levelData.xChangeTime%s;0<v&&(this.xChangeBar.clear(),this.xChangeBar.lineStyle(0.5,o),this.xChangeBar.beginFill(p,1),this.xChangeBar.drawRoundedRect(q,r,v,t,1),this.xChangeBar.endFill())},this),this.xChangeTimer.start(),this.redPlayerScoreText=this.game.add.text(this.redData.scoreText.x,this.redData.scoreText.y,this.redData.score,a),this.redPlayerScoreText.anchor.setTo(0.5),this.bluePlayerScoreText=this.game.add.text(this.blueData.scoreText.x,this.blueData.scoreText.y,this.blueData.score,a),this.bluePlayerScoreText.anchor.setTo(0.5);var u=this.game.add.text(this.bluePlayerScoreText.x,this.bluePlayerScoreText.y+30,'SCORE',b);u.anchor.setTo(0.5);var u=this.game.add.text(this.redPlayerScoreText.x,this.redPlayerScoreText.y-30,'SCORE',b);u.anchor.setTo(0.5)},render:function(){},materialsSetUp:function(){this.asteroidMaterial=this.game.physics.p2.createMaterial('asteroidMaterial'),this.shipMaterial=this.game.physics.p2.createMaterial('shipMaterial'),this.game.physics.p2.setMaterial(this.shipMaterial,[this.shipRed.body,this.shipBlue.body]),this.asteroidShipContactMaterial=this.game.physics.p2.createContactMaterial(this.shipMaterial,this.asteroidMaterial),this.asteroidShipContactMaterial.restitution=0,this.asteroidShipContactMaterial.relaxation=15,this.asteroidShipContactMaterial.surfaceVelocity=0,this.asteroidShipContactMaterial.friction=1,this.asteroidAsteroidContactMaterial=this.game.physics.p2.createContactMaterial(this.asteroidMaterial,this.asteroidMaterial),this.asteroidAsteroidContactMaterial.restitution=0.7,this.shipShipContactMaterial=this.game.physics.p2.createContactMaterial(this.shipMaterial,this.shipMaterial),this.shipShipContactMaterial.restitution=3},createRandomAsteroid:function(a,b){var c=this.levelData.spawnCoords,d=c[Math.floor(Math.random()*c.length)],e=this.game.rnd.integerInRange(-15,15),f=this.game.rnd.integerInRange(-15,15),g={};g.color=this.levelData.colors[Math.floor(Math.random()*this.levelData.colors.length)],g.physic=g.texture,g.mass=1,g.value=this.valueData[Math.floor(Math.random()*this.valueData.length)];var h=this.asteroids.getFirstDead();return a&&b&&(d=[a,b]),!h||20>this.asteroids.children.length?(h=new AsteroidMath.Asteroid(this,d[0]+e,d[1]+f,g),this.asteroids.add(h)):h.reset(d[0]+e,d[1]+f,g),h},asteroidCollide:function(a,b){b.sprite.valuetext.visible=!0,this.game.time.events.add(5*Phaser.Timer.SECOND,function(){b.sprite.valuetext.visible=!1},this)},updateShipScore:function(shipColor,valueText){var player='blue'==shipColor?this.blueData:this.redData,value=eval(valueText.value.replace(/x/g,this.levelData.xValue)),textWithX=this.parseText(valueText.value),textType=0>this.levelData.xValue?'valueNeg':'value',textWithoutX=this.parseText(valueText[textType].replace(/x/g,this.levelData.xValue)),textWithAnswer=textWithoutX+' = '+value,dummyText=this.game.add.text(0,0,textWithAnswer,answerStyle),textWidth=dummyText.width;dummyText.destroy();var textX=player.homeArea.x1+(player.getWidth()-textWidth)/2,textY=(player.homeArea.y2+player.homeArea.y1)/2+-10,answerStyle={font:this.font1,fontSize:'20px',fill:'white'};textWidth>player.getWidth()&&(answerStyle.wordWrap=!0,wordWrapWidth=player.getWidth()-75,textX=player.homeArea.x1+50,textY=player.homeArea.y1+10),this.game.world.bringToTop(player.answerTextWithX),this.game.world.bringToTop(player.answerTextWithOutX),player.answerTextWithX.reset(),player.answerTextWithX.x=textX,player.answerTextWithX.y=textY,player.answerTextWithX.setText(textWithX),player.answerTextWithX.setStyle(answerStyle),player.answerTextWithX.alpha=1,player.answerTextWithX.clearColors(),player.answerTextWithOutX.reset(),player.answerTextWithOutX.x=textX,player.answerTextWithOutX.y=textY,player.answerTextWithOutX.setText(textWithoutX),player.answerTextWithOutX.setStyle(answerStyle),player.answerTextWithOutX.alpha=0,player.answerTextWithOutX.clearColors();for(var str=player.answerTextWithX.text,indices=[],i=0;i<str.length;i++)'x'===str[i]&&indices.push(i);for(var i=0;i<indices.length;i++)player.answerTextWithX.addColor('yellow',indices[i]),player.answerTextWithX.addColor('white',indices[i]+1);this.game.add.tween(player.answerTextWithX).to({alpha:0},1e3,'Expo.easeIn',!0);this.game.time.events.add(1*Phaser.Timer.SECOND,function(){var a=this.game.add.tween(player.answerTextWithOutX).to({alpha:1},2500,'Expo.easeOut',!0);a.onComplete.add(function(){player.answerTextWithOutX.setText(textWithAnswer);var b=player.answerTextWithOutX.text.indexOf('=')+1;0<value?player.answerTextWithOutX.addColor('green',b):player.answerTextWithOutX.addColor('red',b),player.answerTextWithX.kill()},this),this.game.time.events.add(5*Phaser.Timer.SECOND,function(){player.answerTextWithOutX.kill(),player.score+=value,this.bluePlayerScoreText.setText(this.blueData.score),this.redPlayerScoreText.setText(this.redData.score),player.collecting=!1},this,!0)},this,!0)},parseText:function(a){var d={'^2':'\xB2','*':'\u22C5','^0':'\u2070','^3':'\xB3','^4':'\u2074','^6':'\u2076','^1':'\xB9','^5':'\u2075','1/2':'\xBD','1/3':'\u2153','1/5':'\u2155','2/3':'\u2154','1/4':'\xBC','>=:':'\u2265','+-:':'\xB1','-:':'\u2212'};for(var e in d)for(;a.includes(e);){var f=a.indexOf(e);a=a.slice(0,f)+d[e]+a.slice(f+e.length)}return a},testTasks:function(){for(var valueData=Object.values(JSON.parse(this.game.cache.getText(this.levelData.jsonValues))),x=-1,i=0;i<valueData.length;i++)eval(valueData[i].valueNeg.replace(/x/g,x));for(var i=0;i<valueData.length;i++)eval(valueData[i].valueNeg.replace(/x/g,x));x=1;for(var i=0;i<valueData.length;i++)eval(valueData[i].value.replace(/x/g,x));for(var i=0;i<valueData.length;i++)eval(valueData[i].value.replace(/x/g,x))},createPauseBtn:function(){this.pause_label=this.game.add.text(1050,10,'Pause',{font:this.font1,fill:'black',fontSize:'40px'}),this.pause_label.inputEnabled=!0,this.pause_label.events.onInputUp.add(function(){!0==!this.game.paused?(this.game.paused=!0,this.pause_label.text='Paused',this.pause_label.fill='red'):(this.game.paused=!1,this.pause_label.text='Pause',this.pause_label.fill='black')},this),this.bgMusicPlaying=!0,this.soundButton=this.game.add.button(10,10,'soundOn',function(){this.bgMusicPlaying=!this.bgMusicPlaying,this.bgMusicPlaying?(this.bgSound.play(),this.soundButton.loadTexture('soundOn')):(this.bgSound.stop(),this.soundButton.loadTexture('soundOff'))},this),this.soundButton.scale.setTo(0.5)}};var AsteroidMath=AsteroidMath||{};AsteroidMath.MenuState={init:function(){},preload:function(){this.blueScore=[],this.redScore=[],this.game.stage.backgroundColor='#646464'},create:function(){this.game.stage.backgroundColor='black';var a=this.game.add.sprite(this.game.width/2,this.game.height/2,'menubackground');a.anchor.setTo(0.5),a.scale.setTo(0.5),this.createTexts(),this.createButtons(),this.generateKeyInfos(),this.generateLevelDatas(),this.click=this.game.add.audio('click')},startGame:function(){this.click.play(),this.levelData1.roundTime=60*this.roundTime,this.levelData2.roundTime=60*this.roundTime,this.levelData3.roundTime=60*this.roundTime,this.levelData1.xChangeTime=Math.max(25,60*(this.roundTime/3)),this.levelData2.xChangeTime=Math.max(25,60*(this.roundTime/3)),this.levelData3.xChangeTime=Math.max(25,60*(this.roundTime/3)),this.game.state.start('Game',!0,!1,this.levelData1)},createTexts:function(){var a={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'100px'},b={font:AsteroidMath.GameState.font1,fill:'black',fontSize:'40px'},c={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'28px',wordWrap:!0,wordWrapWidth:800,align:'center'},d=this.game.add.text(this.game.width/2,150,'ASTEROIDMATH',a);d.anchor.setTo(0.5),d.setShadow(5,5,'rgba(0,0,0,0.9)',10);var e=this.game.add.text(d.x,d.y+75,'Kahden pelaajan avaruuspeli',b);e.anchor.setTo(0.5);var g=this.game.add.text(d.x,d.y+200,'Ker\xE4\xE4 aluksellasi kappaleita omaan kotipaikkaasi. Kappaleen arvo riippuu muuttujan x arvosta. Yrit\xE4 ker\xE4t\xE4 mahdollisimman monta pistett\xE4',c);g.anchor.setTo(0.5),g.setShadow(3,3,'rgba(0,0,0,0.8)',5)},generateLevelDatas:function(){this.levelData3={name:'Taso 3',jsonValues:'values3',background:'background3',nextLevel:null,roundTime:AsteroidMath.MenuState.roundTime,walls:{wall5:{x:200,y:200,angle:0,staticBody:!1,mass:6},wall6:{x:200,y:400,angle:180,staticBody:!1,mass:6},wall7:{x:900,y:400,angle:180,staticBody:!1,mass:6},wall8:{x:600,y:400,angle:0,staticBody:!0},wall9:{x:600,y:700,angle:0,staticBody:!1,mass:6},wall10:{x:900,y:600,angle:0,staticBody:!1,mass:6}},textColor:'white',xValue:-2,xValues:[-3,-2,-1],xChangeTime:90,colors:['0xfbb03b','0xFFFF00','0x00FFFF','0x0071bc','0x7ac943','0x3fa9f5'],spawnCoords:[[600,300],[600,550],[500,400],[700,400]],BLUEspawn:{x:300,y:750},BLUEhomeArea:{x1:0,x2:250,y1:660,y2:800},BLUEangle:90,BLUEscoreText:{x:50,y:620},BLUEcollecting:!1,BLUEgravityLine:{x1:300,y1:670,x2:300,y2:790},REDspawn:{x:900,y:75},REDhomeArea:{x1:950,x2:1200,y1:0,y2:150},REDangle:-90,REDscore:0,REDscoreText:{x:1135,y:187},REDcollecting:!1,REDgravityLine:{x1:900,y1:10,x2:900,y2:140}},this.levelData2={name:'Taso 2',jsonValues:'values2',background:'background2',nextLevel:AsteroidMath.MenuState.levelData3,roundTime:AsteroidMath.MenuState.roundTime,walls:{wall1:{x:600,y:400,angle:0,staticBody:!0},wall2:{x:200,y:600,angle:180,staticBody:!0},wall3:{x:1e3,y:150,angle:180,staticBody:!0}},textColor:'white',xValue:-2,xValues:[-3,-2,-1,0,1,2,3],xChangeTime:90,colors:['0xfbb03b','0xFFFF00','0x00FFFF','0x0071bc','0x7ac943','0x3fa9f5'],spawnCoords:[[100,600],[105,700],[220,710],[985,54],[1105,74.7],[1118,137],[380,88],[815,703],[974,186],[215,560],[587,531],[603,290]],BLUEspawn:{x:150,y:130},BLUEhomeArea:{x1:25,x2:225,y1:25,y2:125},BLUEangle:135,BLUEscoreText:{x:263,y:170},BLUEcollecting:!1,BLUEgravityLine:{x1:80,y1:235,x2:165,y2:235},REDspawn:{x:1060,y:550},REDhomeArea:{x1:975,x2:1176,y1:680,y2:775},REDangle:-45,REDscore:0,REDscoreText:{x:930,y:675},REDcollecting:!1,REDgravityLine:{x1:1040,y1:600,x2:1140,y2:600}},this.levelData1={name:'Taso 1',jsonValues:'values1',isLastRound:!1,nextLevel:AsteroidMath.MenuState.levelData2,roundTime:AsteroidMath.MenuState.roundTime,textColor:'black',background:'background1',walls:{wall4:{x:600,y:400,angle:0,staticBody:!0}},xValue:-2,xValues:[1,2,3],xChangeTime:60,colors:['0xfbb03b','0xFFFF00','0x00FFFF','0x0071bc','0x7ac943','0x3fa9f5'],spawnCoords:[[170,120],[170,240],[170,550],[170,670],[950,120],[950,240],[950,550],[950,670],[600,150],[600,240],[600,550],[600,670]],BLUEspawn:{x:250,y:400},BLUEhomeArea:{x1:0,x2:190,y1:317,y2:487},BLUEangle:90,BLUEscoreText:{x:35,y:260},BLUEcollecting:!1,BLUEgravityLine:{x1:213,y1:353,x2:213,y2:450},REDspawn:{x:950,y:400},REDhomeArea:{x1:1030,x2:1200,y1:317,y2:487},REDangle:-90,REDscore:0,REDscoreText:{x:1162,y:550},REDcollecting:!1,REDgravityLine:{x1:988,y1:353,x2:988,y2:450}}},generateKeyInfos:function(){var a=this.game.add.sprite(200,600,'keysBlue');a.anchor.setTo(0.5),a.scale.setTo(0.25);var b=this.game.add.sprite(1e3,600,'keysRed');b.anchor.setTo(0.5),b.scale.setTo(0.25);var c=this.game.add.sprite(200,475,'ships','ship_blue.png');c.anchor.setTo(0.5),c.scale.setTo(1.5),c.angle=180,c.alpha=0.8;var d=this.game.add.sprite(1e3,475,'ships','ship_red.png');d.anchor.setTo(0.5),d.scale.setTo(1.5),d.angle=180,d.alpha=0.8},createButtons:function(){var a={font:AsteroidMath.GameState.font1,fill:'white',fontSize:'30px'},b={font:AsteroidMath.GameState.font1,fill:'black',fontSize:'24px'};this.roundTime=3,this.roundsNumber=this.game.add.text(600,430,'Kolme tasoa',b),this.roundsNumber.anchor.setTo(0.5),this.roundTimeInfoText=this.game.add.text(600,460,'Tason pituus (min)',b),this.roundTimeInfoText.anchor.setTo(0.5),this.roundTimeText=this.game.add.text(this.roundTimeInfoText.x,this.roundTimeInfoText.y+40,this.roundTime.toFixed(1),a),this.roundTimeText.anchor.setTo(0.5),this.roundTimeText.setShadow(3,3,'rgba(0,0,0,0.8)',5),this.roundTimeIncrBtn=this.game.add.button(this.roundTimeText.x+50,this.roundTimeText.y,'incrBtn',function(){var d=this.roundTime+0.5;this.roundTime=Math.min(d,6),this.roundTimeText.setText(this.roundTime.toFixed(1)),this.click.play()},this),this.roundTimeIncrBtn.anchor.setTo(0.5),this.roundTimeIncrBtn.scale.setTo(0.1),this.roundTimeDecrBtn=this.game.add.button(this.roundTimeText.x-50,this.roundTimeText.y,'decrBtn',function(){var d=this.roundTime-0.5;this.roundTime=Math.max(d,1),this.roundTimeText.setText(this.roundTime.toFixed(1)),this.click.play()},this),this.roundTimeDecrBtn.anchor.setTo(0.5),this.roundTimeDecrBtn.scale.setTo(0.1),this.playButton=this.game.add.button(this.game.width/2,600,'button1',this.startGame,this),this.playButton.anchor.setTo(0.5),this.playButton.scale.setTo(0.5);var c={font:AsteroidMath.GameState.font1,fill:'green',fontSize:'34px'};this.playButtonText=this.game.add.text(this.playButton.x,this.playButton.y+10,'Aloita',c),this.playButtonText.anchor.setTo(0.5),this.playButtonText.setShadow(3,3,'rgba(0,0,0,0.5)',5),this.playButton.onInputOver.add(function(){this.playButton.alpha=0.7},this),this.playButton.onInputOut.add(function(){this.playButton.alpha=1},this)}};var AsteroidMath=AsteroidMath||{};AsteroidMath.PreloadState={preload:function(){this.preloadBar=this.add.sprite(this.game.world.centerX,this.game.world.centerY,'bar'),this.preloadBar.anchor.setTo(0.5),this.preloadBar.scale.setTo(100,1),this.load.setPreloadSprite(this.preloadBar),this.load.image('button1','assets/images/button1.png'),this.load.image('incrBtn','assets/images/incrBtn.png'),this.load.image('decrBtn','assets/images/decrBtn.png'),this.load.image('soundOn','assets/images/soundOn.png'),this.load.image('soundOff','assets/images/soundOff.png'),this.load.image('menubackground','assets/images/menubackground.png'),this.load.image('endbackground','assets/images/endbackground.png'),this.load.image('keysBlue','assets/images/keysBlue.png'),this.load.image('keysRed','assets/images/keysRed.png'),this.load.image('background1','assets/images/background1.png'),this.load.image('background2','assets/images/background2.png'),this.load.image('background3','assets/images/background3.png'),this.game.load.atlasJSONHash('ships','assets/images/ships.png','assets/images/ships.json'),this.game.load.atlasJSONHash('sprites','assets/images/sprites.png','assets/images/sprites.json'),this.load.physics('physics','assets/data/physics.json'),this.load.image('4x4_red','assets/images/4x4_red.png'),this.load.image('4x4_blue','assets/images/4x4_blue.png'),this.load.text('values1','js/data/values1.json'),this.load.text('values2','js/data/values2.json'),this.load.text('values3','js/data/values3.json'),this.game.load.audio('click',['assets/audio/click.mp3','assets/audio/click.ogg']),this.game.load.audio('1',['assets/audio/1.mp3','assets/audio/1.ogg']),this.game.load.audio('2',['assets/audio/2.mp3','assets/audio/2.ogg']),this.game.load.audio('3',['assets/audio/3.mp3','assets/audio/3.ogg']),this.game.load.audio('begin',['assets/audio/begin.mp3','assets/audio/begin.ogg']),this.game.load.audio('bgMusic',['assets/audio/bgMusic.mp3','assets/audio/bgMusic.ogg']),this.game.load.path='assets/images/',this.game.load.atlas('colorsHD')},create:function(){this.state.start('Menu')}};var AsteroidMath=AsteroidMath||{};AsteroidMath.Asteroid=function(a,b,c,d){Phaser.Sprite.call(this,a.game,b,c,null),this.state=a,this.game=a.game,this.reset(b,c,d,this)},AsteroidMath.Asteroid.prototype=Object.create(Phaser.Sprite.prototype),AsteroidMath.Asteroid.prototype.constructor=AsteroidMath.Asteroid,AsteroidMath.Asteroid.prototype.reset=function(a,b,c){Phaser.Sprite.prototype.reset.call(this,a,b),this.data=c,this.scaleFactor=AsteroidMath.GameState.assetScaleFactor,AsteroidMath.GameState.asteroids.add(this),this.body.mass=this.data.mass;var d=['triangle','rectangle','pentagon','hexagon','circle'],e=d[Math.floor(Math.random()*d.length)];this.body.clearShapes(),this.makeTexture(e),this.body.setCollisionGroup(AsteroidMath.GameState.asteroidCollisionGroup),this.body.collides([AsteroidMath.GameState.asteroidCollisionGroup,AsteroidMath.GameState.playerCollisionGroup,AsteroidMath.GameState.wallsCollisionGroup,AsteroidMath.GameState.backgroundCollisionGroup]),this.game.physics.p2.setMaterial(AsteroidMath.GameState.asteroidMaterial,[this.body]),this.body.damping=AsteroidMath.GameState.ASTEROIDBODYDAMPING,this.scale.set(0);var f=this.game.add.tween(this.scale).to({x:1,y:1},1e3,null,!0),g=Math.random();this.alpha=Math.max(g,0.75),this.body.mass=2*g;this.valuetext=this.game.add.text(this.x,this.y,AsteroidMath.GameState.parseText(c.value.text),{font:'18px Arial',fill:'white'}),this.valuetext.anchor.setTo(0.5),this.valuetext.visible=!1},AsteroidMath.Asteroid.prototype.update=function(){AsteroidMath.GameState.gameOn&&!AsteroidMath.GameState.blueData.collecting&&this.alive&&this.body.x<AsteroidMath.GameState.blueData.homeArea.x2&&this.body.x>AsteroidMath.GameState.blueData.homeArea.x1&&this.body.y<AsteroidMath.GameState.blueData.homeArea.y2&&this.body.y>AsteroidMath.GameState.blueData.homeArea.y1?(AsteroidMath.GameState.blueData.collecting=!0,this.asteroidCollected('blue')):AsteroidMath.GameState.gameOn&&!AsteroidMath.GameState.redData.collecting&&this.alive&&this.body.x<AsteroidMath.GameState.redData.homeArea.x2&&this.body.x>AsteroidMath.GameState.redData.homeArea.x1&&this.body.y<AsteroidMath.GameState.redData.homeArea.y2&&this.body.y>AsteroidMath.GameState.redData.homeArea.y1&&(AsteroidMath.GameState.redData.collecting=!0,this.asteroidCollected('red')),this.valuetext.x=this.x,this.valuetext.y=this.bottom+15},AsteroidMath.Asteroid.prototype.asteroidCollected=function(a){this.alive=!1;var b=this.game.add.tween(this.scale).to({x:0,y:0},1e3,null,!0);b.onComplete.add(function(){this.valuetext.destroy(),Phaser.Sprite.prototype.kill.call(this),this.scale.set(1),'red'==a?AsteroidMath.GameState.updateShipScore('red',this.data.value):AsteroidMath.GameState.updateShipScore('blue',this.data.value),AsteroidMath.GameState.createRandomAsteroid()},this)},AsteroidMath.Asteroid.prototype.makeTexture=function(a){var b=this.game.add.graphics(0,0);if(b.beginFill(this.data.color),'circle'==a)b.drawCircle(0,0,30),b.endFill(),this.loadTexture(b.generateTexture()),this.body.setCircle(15);else if('rectangle'==a)b.drawRect(0,0,30,30),b.endFill(),this.loadTexture(b.generateTexture()),this.body.setRectangle(30,30);else if('triangle'==a){var c=new Phaser.Polygon([41,36,0,36,21,0]);b.drawPolygon(c.points),b.endFill(),this.loadTexture(b.generateTexture()),this.body.loadPolygon('physics','triangle')}else if('pentagon'==a){var c=new Phaser.Polygon([0,12,18,0,36,12,29,34,6,34]);b.drawPolygon(c.points),b.endFill(),this.loadTexture(b.generateTexture()),this.body.loadPolygon('physics','pentagon')}else if('hexagon'==a){var c=new Phaser.Polygon([0,18,10,1,32,1,42,19,31,37,10,37]);b.drawPolygon(c.points),b.endFill(),this.loadTexture(b.generateTexture()),this.body.loadPolygon('physics','hexagon')}b.destroy()};var AsteroidMath=AsteroidMath||{};AsteroidMath.game=new Phaser.Game(1200,800,Phaser.AUTO),AsteroidMath.game.state.add('Boot',AsteroidMath.BootState),AsteroidMath.game.state.add('Preload',AsteroidMath.PreloadState),AsteroidMath.game.state.add('Menu',AsteroidMath.MenuState),AsteroidMath.game.state.add('Game',AsteroidMath.GameState),AsteroidMath.game.state.add('End',AsteroidMath.EndState),AsteroidMath.game.state.start('Boot');